@model Moley.Data.Dto.ApplicationDto

@{
    ViewData["Title"] = "Edit "  + Model.Application.Title + " (" + ViewBag.SystemId + ")";
}




@await Html.PartialAsync("_DefaultAppUI", Model)



@section Scripts
    {
<script>
        var app = new Vue({
            el: '#app',
            data: {
                datalists: [],
                model: {},
                saveApplication: function ()
                {

                    var baseurl = '@Url.Content("~/Application/")';
                    var endpointurl = baseurl + "Save";

                    this.model.ApplicationId = @Model.Application.Id;

                    $.ajax({
                        url: endpointurl,
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(this.model),
                        success: function (response) {
                            window.location.reload(true);
                        }
                    });
                }, 
                setSelectedDataViewValue: function (item, lookupid)
                {
                    var helper = new IntwentyHelper(this);
                    helper.setSelectedDataViewValue(item, lookupid); 
                },
                getDataViewValue: function (viewname, keyfield, lookupid)
                {
                    var senddata = { "ViewName": viewname, "ApplicationId": @Model.Application.Id, "SearchValue": "" }
                    var baseurl = '@Url.Content("~/Application/")';
                    var endpointurl = baseurl + "GetDataViewValue";

                    var helper = new IntwentyHelper(this, endpointurl);
                    helper.getDataViewValue(keyfield, lookupid, senddata); 
                },
                openLookUp: function (modalid)
                {
                    $("#" + modalid).modal();
                }
            },
            mounted: function ()
            {
                var context = this;
                var baseurl = '@Url.Content("~/Application/")';
                var endpointurl = baseurl + "GetLatestVersion/@Model.Application.Id/@ViewBag.SystemId";

                $.get(endpointurl, function (response) {
                    context.model = JSON.parse(response.data);
                     endpointurl = baseurl + "GetDomains/@Model.Application.Id";
                    $.get(endpointurl, function (response) {
                        context.datalists = JSON.parse(response.data);
                    });
                });
            }
        })
</script>

}